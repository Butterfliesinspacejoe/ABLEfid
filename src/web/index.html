<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ABLEfid — Accessible Financial Trust</title>
  <meta name="description" content="ABLEfid helps fiduciaries and beneficiaries manage stablecoin funds simply and securely." />
  <link rel="stylesheet" href="assets/ablefid.css">
</head>

<body>
  <div class="container">
    <header aria-label="Site header">
      <a href="index.html" class="brand" aria-label="ABLEfid home">
        <span class="logo" aria-hidden="true"></span>
        <span class="brand-name">ABLEfid</span>
      </a>
      <nav class="nav-actions" aria-label="Primary">
        <a class="btn btn-outline" href="#learn" id="learnLink">Learn More</a>
        <a class="btn btn-primary" href="login.html" id="loginLink">Login</a>
      </nav>
    </header>

    <section class="hero">
      <h1 class="title">Accessible fiduciary finance with <span class="accent">stablecoins</span>.</h1>
      <p class="subtitle">Send, receive, and track funds for ABLE accounts with a simple web experience—and programmable compliance in the background.</p>
      <div class="cta">
        <a class="btn btn-primary" href="#get-started" id="getStartedBtn">Get Started</a>
        <a class="btn btn-outline" href="#demo" id="watchDemoBtn">Watch Demo</a>
      </div>

      <div class="features" id="learn">
        <article class="card">
          <h3>For Beneficiaries</h3>
          <p>View balances, receive allowances, and spend with optional fiduciary approval.</p>
        </article>
        <article class="card">
          <h3>For Fiduciaries</h3>
          <p>Send funds, set rules, and export reports for SSA/Medicaid compliance.</p>
        </article>
        <article class="card">
          <h3>Stable & Transparent</h3>
          <p>Hold funds in USD‑pegged stablecoins; every transaction is tracked on‑chain.</p>
        </article>
        <article class="card">
          <h3>Web2‑Simple UX</h3>
          <p>Email‑style login flow with a clean, accessible interface—no crypto jargon.</p>
        </article>
      </div>
    </section>

    <a class="btn" href="/demos/flow/login.html">Flow Testnet Login</a>

    <h1>Test the connection to the smart contract!</h1>
    <input type="text" placeholder="Enter a UUID to get a wallet address!" id="userID">
    <button id="connectBtn">Connect</button>

    <h1>Create an account instead!</h1>
    <input type="text" placeholder="Enter the uuid" id="createUser">
    <button id="createButton">Connect</button>



    <h1>Wallet result:</h1>
    <div id="wallet_result"></div>

    <footer>
      <span id="year"></span> © ABLEfid. All rights reserved.
    </footer>
  </div>



  <!--Inline script to just load smart contract addr-->
  <script type="module">
    import { ethers } from "https://cdn.jsdelivr.net/npm/ethers@6.11.1/dist/ethers.min.js";
    const rpcUrl = "https://testnet.evm.nodes.onflow.org";
    const provider = new ethers.JsonRpcProvider(rpcUrl);

    const contractAddress = "0xE0668BAc6c1E123CbC72e6096C267Eabb117A79A"; //.env?
    const abi = [
      "function getWallet(string) view returns (address)"
    ];
    
    //user-uuid-124
    //uuid-12345
    //Get wallet address
    async function test_connection() {
      console.log("Connecting to Flow testnet…");
      const userElement = document.getElementById('userID')
      const user = userElement.value
      
      console.log(`Testing user ${user}`)
      const contract = new ethers.Contract(contractAddress, abi, provider);
      const result = await contract.getWallet(user);
      console.log("Wallet address:", result);
      let walletDiv = document.getElementById("wallet_result")
      walletDiv.innerText = result
    }

    document.getElementById("connectBtn").addEventListener("click", test_connection);
    //document.getElementById("createButton").addEventListener("click", create_account);



    //Create Account
    async function create_account(){
      console.log("hi!")
      

      //Helper
      function randomFlowAddress() {
        // 8 random bytes → 16 hex chars
        let addr = [...crypto.getRandomValues(new Uint8Array(20))]
          .map(b => b.toString(16).padStart(2, "0"))
          .join("");
        return "0x" + addr;
      }

      //Setup info
      const RPC_URL = "https://testnet.evm.nodes.onflow.org";
      const PRIVATE_KEY = "0xcaac23ba960094ee4958423a549ea904331167423f8091fa244a603a58a24704"; //.env, Our dev wallet to pay for this transaction
      const CONTRACT_ADDRESS = "0xE0668BAc6c1E123CbC72e6096C267Eabb117A79A"; //.env
      
      //Get the user input
      const userToAddElement = document.getElementById('createUser')
      const userToAdd = userToAddElement.value

      //Get the contract abi
      const artifact = await fetch("/assets/FlowDB.json").then(res => res.json());
      const abi = artifact.abi;
      
      //Get the provider (testnet)
      const provider = new ethers.JsonRpcProvider(RPC_URL);
      const wallet = new ethers.Wallet(PRIVATE_KEY, provider);
      const contract = new ethers.Contract(CONTRACT_ADDRESS, abi, wallet);

      //Create a random wallet
      const clientWallet = ethers.Wallet.createRandom().connect(provider);
      console.log(`This is your address, save it!!! ${clientWallet.address}`)
      console.log(`This is your private key, save it!!! ${clientWallet.privateKey}`)
  
      
      const addressToAdd = clientWallet.address
      const tx = await contract.setWallet(userToAdd, addressToAdd, { //Those two arguments should be variables
        gasLimit: 500_000,
      });

      const receipt = await tx.wait();
      console.log("Sucessful! This is the block no. - ", receipt.blockNumber);

  }
  
  document.getElementById("createButton").addEventListener("click", create_account);

</script>
  
</body>
</html>
